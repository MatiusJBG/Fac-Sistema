@page "/dashboard"
@using Microsoft.AspNetCore.Components.Routing
@inject NavigationManager NavigationManager

<div class="dashboard-layout @(isSidebarCollapsed ? "sidebar-collapsed" : "")">

    <header class="dashboard-header">
        <div class="header-left">
            <span class="logo-text">Facturatex</span>
        </div>
        <div class="header-center">
            <span>¬°Hola, Maria M!</span>
        </div>
        <div class="header-right">
            <button class="btn btn-primary" @onclick="NavigateToFactura">Nueva Factura</button>
        </div>
    </header>

    <aside class="dashboard-sidebar">
        <button @onclick="ToggleSidebar" class="sidebar-toggle">
            <span>@(isSidebarCollapsed ? "‚Üí" : "‚Üê")</span>
        </button>

        <nav class="sidebar-nav">
            <NavLink href="/clientes" class="nav-link">
                <span class="nav-icon">üë•</span>
                <span class="nav-text">Clientes</span>
            </NavLink>
            <NavLink href="/productos" class="nav-link">
                <span class="nav-icon">üì¶</span>
                <span class="nav-text">Productos</span>
            </NavLink>
            <NavLink href="/retenciones" class="nav-link">
                <span class="nav-icon">üìÑ</span>
                <span class="nav-text">Retenciones</span>
            </NavLink>
        </nav>
    </aside>

    <main class="dashboard-content">

        <div class="section-header">
            <h3>√öltimos documentos recibidos</h3>
        </div>
        <div class="latest-documents-carousel">
            @foreach (var doc in LatestDocuments)
            {
                <div class="document-card">
                    <div class="document-header">
                        <span class="document-company">@doc.Company</span>
                        <span class="document-amount">@doc.Amount</span>
                    </div>
                    <div class="document-details">
                        <span class="document-type">@doc.Type</span>
                        <span class="document-number">No. @doc.Number</span>
                        <span class="document-date">@doc.Date.ToString("dd/MM/yyyy")</span>
                    </div>
                </div>
            }
        </div>

        <div class="section-header">
            <h3>Resumen General</h3>
        </div>
        <div class="summary-cards-grid">
            <div class="summary-card card-comprobantes">
                <span class="card-title">Comprobantes Recibidos</span>
                <span class="card-value">@SummaryData.ComprobantesRecibidos Documentos</span>
            </div>
            <div class="summary-card card-borradores">
                <span class="card-title">Borradores</span>
                <span class="card-value">@SummaryData.Borradores Documentos</span>
            </div>
            <div class="summary-card card-facturas">
                <span class="card-title">Facturas</span>
                <span class="card-value">@SummaryData.FacturasEmitidas Emitidas</span>
            </div>
        </div>

        <div class="section-header">
            <h3>Presupuesto @(DateTime.Now.ToString("MMMM yyyy", new System.Globalization.CultureInfo("es-ES")))</h3>
        </div>
        <div class="budget-table-container">
            <table class="budget-table">
                <thead>
                    <tr>
                        <th>Descripci√≥n</th>
                        <th>Categor√≠a</th>
                        <th>Monto</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in BudgetItems)
                    {
                        <tr>
                            <td>@item.Description</td>
                            <td>@item.Category</td>
                            <td>@item.Amount.ToString("C")</td>
                            <td><span class="status-pill status-@item.Status.ToLower()">@item.Status</span></td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </main>
</div>

@code {
    private bool isSidebarCollapsed = false;

    // --- Clases de Ejemplo Corregidas (para las advertencias) ---
    private class DocumentoEjemplo
    {
        public string Company { get; set; } = string.Empty;
        public string LogoUrl { get; set; } = string.Empty;
        public string Amount { get; set; } = string.Empty;
        public string Type { get; set; } = string.Empty;
        public string Number { get; set; } = string.Empty;
        public DateTime Date { get; set; }
    }

    private class ResumenEjemplo
    {
        public int ComprobantesRecibidos { get; set; }
        public int Borradores { get; set; }
        public int FacturasEmitidas { get; set; }
        public int NotasCredito { get; set; }
        public int Retenciones { get; set; }
        public int GuiasRemision { get; set; }
    }

    private class PresupuestoEjemplo
    {
        public string Description { get; set; } = string.Empty;
        public string Category { get; set; } = string.Empty;
        public decimal Amount { get; set; }
        public string Status { get; set; } = string.Empty;
    }

    // --- Listas y M√©todos Originales ---
    private List<DocumentoEjemplo> LatestDocuments { get; set; } = new List<DocumentoEjemplo>();
    private ResumenEjemplo SummaryData { get; set; } = new ResumenEjemplo();
    private List<PresupuestoEjemplo> BudgetItems { get; set; } = new List<PresupuestoEjemplo>();

    protected override void OnInitialized()
    {
        CargarDocumentosEjemplo();
        CargarResumenEjemplo();
        CargarPresupuestoEjemplo();
    }

    private void CargarDocumentosEjemplo()
    {
        LatestDocuments = new List<DocumentoEjemplo>
        {
            new DocumentoEjemplo { Company = "DIFAR S.A.", LogoUrl = "", Amount = "$ 5,51", Type = "FACTURA", Number = "066-021-000297906", Date = new DateTime(2021, 08, 28) },
            new DocumentoEjemplo { Company = "CLARO", LogoUrl = "", Amount = "$ 25,99", Type = "FACTURA", Number = "001-001-000123456", Date = new DateTime(2021, 08, 27) },
            new DocumentoEjemplo { Company = "MI COMISARIATO", LogoUrl = "", Amount = "$ 45,67", Type = "FACTURA", Number = "001-002-000789012", Date = new DateTime(2021, 08, 26) },
            new DocumentoEjemplo { Company = "SUPERCINES", LogoUrl = "", Amount = "$ 12,50", Type = "FACTURA", Number = "003-001-000456789", Date = new DateTime(2021, 08, 25) }
        };
    }

    private void CargarResumenEjemplo()
    {
        SummaryData = new ResumenEjemplo
        {
            ComprobantesRecibidos = 138,
            Borradores = 0,
            FacturasEmitidas = 26,
            NotasCredito = 1,
            Retenciones = 0,
            GuiasRemision = 0
        };
    }

    private void CargarPresupuestoEjemplo()
    {
        BudgetItems = new List<PresupuestoEjemplo>
        {
            new PresupuestoEjemplo { Description = "Arriendo Oficina", Category = "Gastos Fijos", Amount = 500.00m, Status = "Completado" },
            new PresupuestoEjemplo { Description = "Materiales de Oficina", Category = "Suministros", Amount = 75.50m, Status = "Pendiente" },
            new PresupuestoEjemplo { Description = "Campa√±a Publicitaria", Category = "Marketing", Amount = 200.00m, Status = "En Curso" },
            new PresupuestoEjemplo { Description = "Servicio de Limpieza", Category = "Gastos Fijos", Amount = 80.00m, Status = "Completado" }
        };
    }

    private void ToggleSidebar()
    {
        isSidebarCollapsed = !isSidebarCollapsed;
    }

    private void NavigateToFactura()
    {
        NavigationManager.NavigateTo("/factura");
    }
}